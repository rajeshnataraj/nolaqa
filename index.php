<?php$randomdate=date('Y-m-d H:i:s');@include("sessioncheck.php");$show_licence_expiry_banner = false;$expiration_message = "";function handle_licence_expiry_banner(){    global $show_licence_expiry_banner;    global $ObjDB;    global $expiration_message;    if (isset($_COOKIE['suppress_licence_expiry'])) {    } else {        //If licence expiry notification is not suppressed, determine if the user should see the licence expiration banner        $licence_expiry_date_query = "SELECT                lictrack.fld_end_date as licenseExpiration             FROM                itc_user_master as user            LEFT JOIN                itc_license_track AS lictrack            ON                (user.fld_district_id = lictrack.fld_district_id AND lictrack.fld_district_id != 0 AND lictrack.fld_delstatus = '0' AND lictrack.fld_user_id = '0')            OR                (lictrack.fld_district_id = 0 AND user.fld_school_id = lictrack.fld_school_id AND lictrack.fld_school_id != 0 AND lictrack.fld_user_id = '0')            OR                (user.fld_id = lictrack.fld_user_id AND lictrack.fld_school_id = 0 AND lictrack.fld_district_id = 0)            LEFT JOIN                itc_license_master AS lic            ON                lic.fld_id = lictrack.fld_license_id            WHERE                user.fld_id = " . intval($_SESSION['userid']) . " AND                lic.fld_delstatus = '0' AND                lictrack.fld_delstatus = '0'            ORDER BY                lictrack.fld_end_date            DESC            LIMIT 1";        $licence_expiry_date = $ObjDB->SelectSingleValue($licence_expiry_date_query);        if (isset($licence_expiry_date) && $licence_expiry_date != "") {            $cutoff_date = strtotime("+75 day", time());            $expiry_date = strtotime($licence_expiry_date);            if($expiry_date < $cutoff_date)            {                $user_friendly_expiration_date = date('Y-m-d', strtotime($licence_expiry_date));                $current_date_timestamp = strtotime(date('Y-m-d'));                $expiration_date_timestamp = strtotime(date('Y-m-d', strtotime($licence_expiry_date)));                $show_licence_expiry_banner = true;                $days_to_expiration = ($expiration_date_timestamp - $current_date_timestamp)/ (24*60*60);                if ($days_to_expiration <= 0){                    $expiration_message = "Your Synergy ITC license expired on $user_friendly_expiration_date. Please contact Pitsco Sales Support to renew the subscription. (800-828-5787 or <a href=\"mailto:salessupport@pitsco.com\" style=\"text-decoration: underline;\">salessupport@pitsco.com</a>)";                }else {                    $expiration_message = "Your Synergy ITC license will expire in $days_to_expiration days. Please contact Pitsco Sales Support to renew the subscription. (800-828-5787 or <a href=\"mailto:salessupport@pitsco.com\" style=\"text-decoration: underline;\">salessupport@pitsco.com</a>)";                }            }            else{                $show_licence_expiry_banner = false;            }        }    }}$today=date('Y-m-d');$message=$ObjDB->SelectSingleValueInt("SELECT COUNT(fld_id) FROM itc_message_master WHERE fld_readstatus='0' AND fld_to='".$uid."' AND fld_shownewmessage='0' AND fld_delstatus='0'");$calendar=$ObjDB->SelectSingleValueInt("SELECT COUNT(fld_id) FROM itc_calendar_master WHERE fld_created_by='".$uid."' AND fld_delstatus='0'AND fld_startdate='".$today."'");$studentlock=$ObjDB->SelectSingleValueInt("SELECT COUNT(a.fld_id)  FROM itc_assignment_sigmath_master AS a LEFT JOIN itc_class_teacher_mapping AS b ON a.fld_class_id=b.fld_class_id LEFT JOIN itc_class_sigmath_master AS c ON c.fld_id=a.fld_schedule_id LEFT JOIN itc_class_master AS d ON d.fld_id=a.fld_class_id LEFT JOIN itc_user_master AS e ON e.fld_id=a.fld_student_id  LEFT JOIN itc_ipl_master AS f ON f.fld_id=a.fld_lesson_id WHERE a.fld_type=5 AND b.fld_teacher_id='".$uid."' AND b.fld_flag='1'  AND c.fld_delstatus='0' AND d.fld_delstatus='0' AND e.fld_delstatus='0' AND f.fld_delstatus='0'");$classlock=$ObjDB->SelectSingleValueInt("SELECT COUNT(a.fld_id) FROM itc_class_master AS a LEFT JOIN itc_class_teacher_mapping AS b ON b.fld_class_id=a.fld_id WHERE (b.fld_teacher_id='".$uid."' or a.fld_created_by='".$uid."') AND a.fld_lock=1 AND a.fld_delstatus='0' AND b.fld_flag='1'");if($sessmasterprfid < 10){    $passupdated= dbSelectSimple("itc_user_master", "fld_id", $uid);    handle_licence_expiry_banner();}?>    <!DOCTYPE HTML>    <html class='no-js' itemscope='' itemtype='http://schema.org/Product' lang='en'>    <head>        <meta charset='utf-8'>        <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>        <title>Synergy ITC | PITSCO Education</title>        <meta content='' name='description' />        <meta content='' name='keywords' />        <meta content='humans.txt' name='author' />        <meta content='width=device-width,initial-scale=1' name='viewport' />        <link href='favicon.ico' rel='shortcut icon' type='image/x-icon' />        <link href='css/gzip-css.php?<?php echo $randomdate;?>' rel='stylesheet' type="text/css" />        <link rel="stylesheet" type="text/css" href="fancybox/jquery.fancybox-1.3.4.css" media="screen" />        <link href='css/fixedtable.css?<?php echo $randomdate;?>' rel='stylesheet' type="text/css" />        <script language="javascript" type="text/javascript" src='js/libs/modernizr-2.0.6.min.js'></script><!--        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" />--><!--        <script language="javascript" type="text/javascript" src='https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js'></script>-->        <style>            .dropbtn {                background-color: #6d99b2;                color: white;                padding: 10px;                font-size: 16px;                border: none;                cursor: pointer;                width: 250px;            }            .dropbtn:hover, .dropbtn:focus {                background-color: #6d99b2;            }            .dropdown1 {                position: relative;                display: inline-block;            }            .dropdown1-content {                display: none;                position: absolute;                background-color: #f9f9f9;                width: 250px;                white-space: nowrap;                max-width: 250px;                max-height: 600px;                min-height: 200px;                overflow: auto;                box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);            }            .dropdown1-content a {                color: black;                padding: 12px 16px;                text-decoration: none;               display: block;            }            .dropdown1 a:hover {background-color: #f1f1f1}            .show {display:block;}            hr{                border-width: 1px;                border-style: solid;                margin-top: 0.5em;                margin-bottom: 0.5em;            }        </style>    </head>    <body>    <?php include_once("analyticstracking.php"); ?>    <?php    if($sessmasterprfid == 10){        ?>        <section class='topNav z0'>            <div class='row'>                <div class="twelve columns alpha">                    <div class="row">                        <div class='six columns'>                            <div class="topinnerleft">                                <span class="left navUserIcon icon-synergy-user"></span>                                <span class="left navUserName"><?php echo $username; ?></span>                                <span class="left navUserDateTime margintop"></span>                                <div class="four columns">                                    <div id="loaddiv">                                        <?php                                        if($uid1==''){?>  <!--$message!=0 &&-->                                            <div>                                                <a class='icon-synergy-mail dashBlueIcons right' id="msga" onClick="fn_click(2);" onMouseOver="fn_mouseover(2);"   style="cursor:pointer;margin-right:20px; width:20px;margin-top: 1px;<?php if($message==0 && $uid1==''){?>display:none;<?php }?> " >                                                    <div id="msg" style="display:none" class="dashCalloutTextBig">New Message</div></a> </div>                                            <?php                                        }                                        if($uid1==''){                                            ?> <!--$calendar!=0 &&-->                                            <div>                                                <a class='icon-synergy-calendar dashBlueIcons right' id="cala" onClick="fn_click(3);" onMouseOver="fn_mouseover(3);"  style="cursor:pointer;margin-right:20px; width:20px;margin-top: 1px;<?php if($calendar==0 && $uid1==''){?>display:none;<?php }?>  ">                                                    <div id="cal" style="display:none"   class="dashCalloutTextBig">Today's Event</div> </a>                                            </div>                                            <?php                                        }                                        ?>                                    </div>                                </div>                                <a href="logout.php?id=1" title="Logout" class="icon-synergy-power tooltip navUserIcon right"></a>                            </div>                        </div>                        <div class='six columns alpha'>                            <?php                            if($uid1 == ''){                                ?>                                <div class="topinnerright">                                    <span class="left navUserIcon icon-synergy-user dim"></span>                                    <span class="left navUserNameLight"><?php echo "companion user log in"; ?></span>                                    <a href="logout.php?id=2" title="Logout" class="icon-synergy-power tooltip navUserIcon right dim"></a>                                </div>                                <?php                            }else {                                ?>                                <div class="topinnerleft">                                    <span class="left navUserIcon icon-synergy-user"></span>                                    <span class="left navUserName"><?php echo $username1; ?></span>                                    <a href="logout.php?id=2" title="Logout" class="icon-synergy-power tooltip navUserIcon right"></a>                                </div>                                <?php                            }                            ?>                        </div>                    </div>                </div>            </div>        </section>        <?php    }else {        ?>        <section class='topNav z0 navBarBase'>            <div class='row'>                <div class='five columns alpha dash'>                    <span class="left navUserIcon icon-synergy-admin marginstop"></span>                    <span class="left navUserName margintop"><?php echo $sessusrfullname; ?>&nbsp;(<?php echo $sessprofilename;?>)</span>                    <span class="left navUserDateTime margintop">                        <ul id="digital-clock" class="digital">                            <li class="day"></li>                            <li class="hour"></li>                            <li class="min"></li>                            <li class="sec"></li>                            <li class="meridiem"></li>                        </ul>                    </span>                </div>                <?php                if($sessmasterprfid == 5 or $sessmasterprfid == 7 or $sessmasterprfid == 8 or $sessmasterprfid == 9){                    ?>                    <div id="teachermsg" style="display: none;" class='three columns'>                        <div class="dropdown1">                            <button onclick="myFunction(<?php echo $uid;?>)" class="dropbtn">Missing Assessments  <img id="upasses" src="img/arrowup.png" alt="Up" style="vertical-align: middle;" /> <img style="display: none;vertical-align: middle;" id="downasses" src="img/arrowdown.png" alt="Down" /><span id="totaltest"></span></button>                            <div id="myDropdown" class="dropdown1-content">                            </div>                        </div>                    </div>                    <?php                }                ?>                <div class='four columns'>                    <a href="logout.php" title="Logout" class="icon-synergy-power tooltip navLogOut right"></a>                    <div class="logo_nav right dash"></div>                    <div id="loaddiv">                        <div>                            <a class='icon-synergy-locked dashRedIcons right' id="classloka" onClick="fn_click(0);" onMouseOver="fn_mouseover(0);" style="cursor:pointer; margin-right:20px; width:20px; <?php if($classlock==0){?> display:none; <?php }?> ">                                <div id="classlok" style="display:none;" class="dashCalloutTextBig">Class Locked</div></a>                        </div>                        <div>                            <a class='icon-synergy-locked dashRedIcons right' id="loka" onClick="fn_click(1);" onMouseOver="fn_mouseover(1);" style="cursor:pointer; margin-right:20px; width:20px; <?php if($studentlock==0){?>display:none;<?php }?> ">                                <div id="lok" style="display:none;" class="dashCalloutTextBig">Student Locked</div></a>                        </div>                        <?php                        if($message!=0){                            ?>                            <div>                                <a class='icon-synergy-mail dashBlueIcons right' id="msga"  onClick="fn_click(2);" onMouseOver="fn_mouseover(2);" style="cursor:pointer;margin-right:20px; width:20px; <?php if($message==0){?>display:none;<?php }?> " >                                    <div id="msg" style="display:none" class="dashCalloutTextBig">New Message</div></a>                            </div>                            <?php                            $ObjDB->NonQuery("UPDATE itc_message_master SET fld_shownewmessage='1'                             WHERE fld_to='".$uid."' AND fld_delstatus='0'");                        }                        ?>                        <div>                            <a class='icon-synergy-calendar dashBlueIcons right' id="cala" onClick="fn_click(3);" onMouseOver="fn_mouseover(3);" style="cursor:pointer;margin-right:20px; width:20px;<?php if($calendar==0){?>display:none;<?php }?> ">                                <div id="cal" style="display:none" class="dashCalloutTextBig">Today's Event</div></a>                        </div>                    </div>                </div>            </div>        </section>        <?php        /* Display the licence expiration expiry banner to non-student users. */        if ($show_licence_expiry_banner) {            ?>            <section id="licence_expiration_banner" style="display: block; background: #ffff00; position: fixed; top: 50px; left: 0; right: 0; z-index: 900; padding-left: 20px; padding-right: 20px;">                <?= $expiration_message; ?>                <span style="float: right; cursor: pointer;" onclick="fn_close_licence_expiration_banner()">X</span>            </section>            <?php        }    }    $id1 = isset($_REQUEST['id']) ? $_REQUEST['id'] : '';    $id = explode(",", $id1);    /*********Student Passport Code start here********************/    if($id[0] != 1 and $id[0] !="passport")/*********Student Passport Code End here********************/    {        ?>        <audio autoplay=''>            <source src='css/sound/synergyEntrance.ogg' type='audio/ogg'>            <source src='css/sound/synergyEntrance.mp3' type='audio/mpeg'>        </audio>        <?php    }    ?>    <script language="javascript" type="text/javascript" src='js/gzip-js.php'></script>    <script language="javascript" type="text/javascript" src='tiny_mce/tiny_mce.js'></script>    <script language="javascript" type="text/javascript" src="tiny_mce/plugins/asciimath/js/ASCIIMathMLwFallback.js"></script>    <script language="javascript" type="text/javascript" src="tiny_mce/plugins/asciisvg/js/ASCIIsvg.js"></script>    <script language="javascript" type="text/javascript" src="js/jquery.updater.js"></script>    <script language="javascript" type="text/javascript" src="js/jquery.periodicalupdater.js"></script>    <script type="text/javascript">        var AScgiloc = 'tiny_mce/php/svgimg.php';        var AMTcgiloc = "cgi-bin/mathtex.cgi";        <?php if($sessmasterprfid == 5 or $sessmasterprfid == 7 or $sessmasterprfid == 8 or $sessmasterprfid == 9){ ?>        //setTimeout('fn_testalert();',500);        <?php } ?>    </script>    <script type="text/javascript" language="javascript">        <?php if($uid1==''  ){?>        $.PeriodicalUpdater(ITC_URL + '/ajaxpages/lockstatus.php', {            method: 'post',          // method; get or post            data: 'oper=lockstatus',               // array of values to be passed to the page - e.g. {name: "John", greeting: "hello"}            minTimeout: 10000,       // starting value for the timeout in milliseconds            maxTimeout: 30000,       // maximum length of time between requests            multiplier: 2,          // the amount to expand the timeout by if the response hasn't changed (up to maxTimeout)            type: 'text',           // response type - text, xml, json, etc.  See $.ajax config options            maxCalls: 0,            // maximum number of calls. 0 = no limit.            autoStop: 0,            // automatically stop requests after this many returns of the same data. 0 = disabled.            autoStopCallback: function() { } ,// The callback to execute when the autoStop condition is reached            cookie: {},             // configuration for the timeout-storing cookie            verbose: 0              // Sets the console logging verbosity: 0=none, 1=some, 2=all        }, function(remoteData, success, xhr, handle) {            var data=remoteData.split('~');            var tempdata = data[4];            <?php $temdata1 =  tempdata;?>            if(data[0]!=0 && data[0]!=undefined){                $('#loka').show();                $('#lok').slideDown('slow').slideUp(3500);                if($('#teach-studentlock').is(":visible")){                    fn_click(1);                }            }            if(data[1]!=0 && data[1]!=undefined){                $('#msga').show();                $('#msg').slideDown('slow').slideUp(3500);            }            else{                $('#msga').hide();            }            if(data[2]!=0 && data[2]!=undefined){                $('#cala').show();            }            if(data[3]!=0 && data[3]!=undefined){                $('#classloka').show();            }            else            {                $('#classloka').hide();            }            if(data[5]==2 && data[5]!=undefined){                var msgfrom = "Pitscoadmin";            }            else            {                var msgfrom = "Teacher";            }            if(data[6]==1 && data[6]!=undefined){                var msgcontent = data[4];            }            else if(data[6]>1)            {                var msgcontent = "You have more than one alert message. Please check the Inbox.";            }            <?php            if($temdata1 !=''){            ?>            if(data[4] != 0 && msgcontent!=undefined){                var md = $.Zebra_Dialog('<div style="height:200px; overflow-y:auto;">'+msgcontent+'</div>', {                    'type':     'question',                    'title':    'Notification - Message from '+msgfrom,                    'buttons':  [                        {caption: 'Ok', callback: function() { $('.ZebraDialog').remove();$('.ZebraDialogOverlay').remove();fn_alertclose();}}                    ]                });                return false;            }            <?php            }            ?>            // Process the new data (only called when there was a change)            // For a description of "success", see $.ajax documentation        });        function fn_alertclose(){            var dataparam = "oper=alertclose";            $.ajax({                type: 'post',                url: 'assignment/sigmath/assignment-sigmath-test-ajax.php',                data: dataparam,            });        }        <?php } ?>        $(function() {            $('#digital-clock').clock({type: 'digital'});            var tieout = 3600000;            $(document).bind("idle.idleTimer", function() {                $.timeoutDialog({ timeout: 1, countdown: 60, logout_redirect_url: '<?php echo $domainame; ?>logout.php', restart_on_yes: false });            });            $(document).bind("active.idleTimer", function() {            });            $.idleTimer(tieout);            $('.tooltip').tipsy({live:true,title:'title'});        });        <?php        if($_SESSION['moduleid']!='' AND $_SESSION['scheduleid']!='' AND $_SESSION['scheduletype']!='')        {        ?>        setTimeout('showpageswithpostmethod("assignment","assignment/assignment.php","id=<?php echo $uid;?>")',1000);        setTimeout('showpageswithpostmethod("assignment-science-sessions","assignment/science/assignment-science-sessions.php","id=<?php echo $_SESSION['scheduleid']."~".$_SESSION['moduleid']."~".$_SESSION['scheduletype']."~".$_SESSION['sessionid']."~".$_SESSION['type'];?>")',2000);        <?php        }        ?>        <?php        /*********Student Passport Code start here********************/        if($id[0] == "passport")        { ?>        setTimeout('showpageswithpostmethod("tools","tools/tools.php","id=5")',1000);        setTimeout('showpageswithpostmethod("tools-passport-passport","tools/passport/tools-passport-passport.php","id=<?php echo $id[0].",".$id[1].",".$id[2].",".$id[3].",".$id[4].",".$id[5].",".$id[6].",".$id[7];?>")',1500);        <?php        }        ?>        /**karthick Updated by 3/09/2015*/        <?php        if($id[0]=='5' AND $id[1]!='' AND $id[2]!='' AND $id[3]!='')        {        $pagename = $id[4];        if($pagename=="exp" or $pagename=="exp001"){ $pagename1=11; } // exp page        if($pagename=="exped_dest" or $pagename=="exp001_dest"){ $pagename1=22;} // destination page        if($pagename=="dest_task" or $pagename=="exp001_task"){ $pagename1=33;}// task page        if($pagename=="task_reso"){ $pagename1=44;}// task page        $txpassport = $pagename1.",".$id[5].",".$id[6].",".$id[7].",".$id[8];        ?>        setTimeout('showpageswithpostmethod("assignment","assignment/assignment.php","id=46")',1000);        setTimeout('showpageswithpostmethod("assignment-expedition-show","assignment/expedition/assignment-expedition-show.php","id=<?php echo $id[1]."~".$id[2]."~".$id[3]."~".$txpassport;?>")',2000);        <?php        }        ?>        /*********Student Passport Code End here********************/    </script>    <?php    if(strtotime($passupdated[0]['fld_pass_updated']) < strtotime('-1 year') && $sessmasterprfid < 10) include 'verifyaccountinfo.php';    ?>    <script src="js/checkContent.js"></script>    </body>    </html><?php$_SESSION['pagespeed1'] = 0;